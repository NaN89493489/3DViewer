#include "test.h"

START_TEST(test1_3d_moving) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};
  move_coord(&vertex, 100, 0, MinMax);

  float vertex2[] = {27.000000, 48.000000, 0.000000,  1.000000,  0.500000,
                     -0.500000, 1.000000,  -0.500000, -0.500000, 1.000000,
                     0.500000,  0.500000,  1.000000,  -0.500000, 0.500000,
                     0.000000,  0.500000,  -0.500000, 0.000000,  -0.500000,
                     -0.500000, 0.000000,  0.500000,  0.500000,  0.000000,
                     -0.500000, 0.500000};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

START_TEST(test2_3d_rotateX) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};
  rotateXX(&vertex, 100, MinMax);

  float vertex2[] = {
      27.000000, 48.000000, 0.000000, 0.500000,  0.405579,  0.579228, 0.500000,
      0.579228,  -0.405579, 0.500000, -0.579228, 0.405579,  0.500000, -0.405579,
      -0.579228, -0.500000, 0.405579, 0.579228,  -0.500000, 0.579228, -0.405579,
      -0.500000, -0.579228, 0.405579, -0.500000, -0.405579, -0.579228};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

START_TEST(test3_3d_rotateY) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};

  rotateYY(&vertex, 100, MinMax);

  float vertex2[] = {27.000000, 48.000000, 0.000000,  -0.579228, 0.500000,
                     -0.405579, -0.579228, -0.500000, -0.405579, 0.405579,
                     0.500000,  -0.579228, 0.405579,  -0.500000, -0.579228,
                     -0.405579, 0.500000,  0.579228,  -0.405579, -0.500000,
                     0.579228,  0.579228,  0.500000,  0.405579,  0.579228,
                     -0.500000, 0.405579};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

START_TEST(test4_3d_rotateZ) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};

  rotateZZ(&vertex, 100, MinMax);

  float vertex2[] = {27.000000, 48.000000, 0.000000,  -0.579228, 0.405579,
                     -0.500000, 0.405579,  0.579228,  -0.500000, -0.579228,
                     0.405579,  0.500000,  0.405579,  0.579228,  0.500000,
                     -0.405579, -0.579228, -0.500000, 0.579228,  -0.405579,
                     -0.500000, -0.405579, -0.579228, 0.500000,  0.579228,
                     -0.405579, 0.500000};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

START_TEST(test5_3d_scaling) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};

  scaling(&vertex, 100, MinMax);

  float vertex2[] = {27.000000, 48.000000, 0.000000,  0.750000,  0.750000,
                     -0.750000, 0.750000,  -0.750000, -0.750000, 0.750000,
                     0.750000,  0.750000,  0.750000,  -0.750000, 0.750000,
                     -0.750000, 0.750000,  -0.750000, -0.750000, -0.750000,
                     -0.750000, -0.750000, 0.750000,  0.750000,  -0.750000,
                     -0.750000, 0.750000};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

START_TEST(test6_3d_moveToCentre) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};

  moveToCentre(&vertex, 10, 10, 10, MinMax);

  float vertex2[] = {27.000000, 48.000000, 0.000000,  0.450000,  0.450000,
                     -0.550000, 0.450000,  -0.550000, -0.550000, 0.450000,
                     0.450000,  0.450000,  0.450000,  -0.550000, 0.450000,
                     -0.550000, 0.450000,  -0.550000, -0.550000, -0.550000,
                     -0.550000, -0.550000, 0.450000,  0.450000,  -0.550000,
                     -0.550000, 0.450000};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

START_TEST(test7_3d_moveFromCentre) {
  float vertex1[] = {27.000000, 48.000000, 0.000000,  0.500000,  0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, 0.500000,
                     0.500000,  0.500000,  0.500000,  -0.500000, 0.500000,
                     -0.500000, 0.500000,  -0.500000, -0.500000, -0.500000,
                     -0.500000, -0.500000, 0.500000,  0.500000,  -0.500000,
                     -0.500000, 0.500000};
  float *vertex = NULL;
  vertex = &(*vertex1);
  float MinMax[6] = {-0.5, 0.5, -0.5, 0.5, -0.5, 0.5};
  moveFromCentre(&vertex, -10, -10, -10, MinMax);

  float vertex2[] = {27.000000, 48.000000, 0.000000,  0.450000,  0.450000,
                     -0.550000, 0.450000,  -0.550000, -0.550000, 0.450000,
                     0.450000,  0.450000,  0.450000,  -0.550000, 0.450000,
                     -0.550000, 0.450000,  -0.550000, -0.550000, -0.550000,
                     -0.550000, -0.550000, 0.450000,  0.450000,  -0.550000,
                     -0.550000, 0.450000};

  for (int i = 0; i < 27; i++) {
    ck_assert_float_eq_tol(vertex1[i], vertex2[i], 0.000001);
  }
}
END_TEST

Suite *test_3d_moving(void) {
  Suite *s;
  TCase *tc;

  s = suite_create("\033[43m-=S21_3D_MOVING=-\033[0m.");
  /* Core test case */
  tc = tcase_create("add_tc");

  tcase_add_test(tc, test1_3d_moving);
  tcase_add_test(tc, test2_3d_rotateX);
  tcase_add_test(tc, test3_3d_rotateY);
  tcase_add_test(tc, test4_3d_rotateZ);
  tcase_add_test(tc, test5_3d_scaling);
  tcase_add_test(tc, test6_3d_moveToCentre);
  tcase_add_test(tc, test7_3d_moveFromCentre);

  suite_add_tcase(s, tc);

  return s;
}